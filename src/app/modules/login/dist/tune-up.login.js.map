{"version":3,"file":"tune-up.login.js","sources":["../src/config/validations.js","../src/config/config.js","../src/services/login.service.js","../src/services/sites.service.js","../src/login.component.js","../src/login.routing.js","../src/components/siteselector/siteselector.component.js","../src/login.module.js"],"sourcesContent":["export const validations = {\n  login: {\n    email: [\n      {\n        isEmail: {\n          message: 'Debe ser un email válido'\n        }\n      },\n      {\n        required: {\n          message: 'El email es requerido'\n        }\n      }\n    ],\n    password: [\n      {\n        required: {\n          message: 'La contraseña es requerida'\n        }\n      }\n    ]\n  }\n};\n","import {configService} from '@tune-up/core';\r\nimport {validations} from './validations';\r\n\r\nconfigService.addValidations(validations);\r\n","import {Injectable} from '@angular/core';\r\nimport {HttpClient} from '@angular/common/http';\r\n\r\n@Injectable()\r\nexport class LoginService {\r\n  constructor(http: HttpClient) {\r\n    this._http = http;\r\n    this._url = 'Login2';\r\n  }\r\n  login(model) {\r\n    return this._http.post(this._url, model);\r\n  }\r\n}\r\n","import {Injectable} from '@angular/core';\r\nimport {HttpClient} from '@angular/common/http';\r\n\r\n@Injectable()\r\nexport class SitesService {\r\n  constructor(http: HttpClient) {\r\n    this._http = http;\r\n    this._url = 'Sitios';\r\n  }\r\n  get(email) {\r\n    return this._http.get(`${this._url}\\\\${email}`);\r\n  }\r\n}\r\n","import { Router, ActivatedRoute } from '@angular/router';\nimport { Component, ViewChild } from '@angular/core';\nimport {\n  AuthService,\n  AgentService,\n  AboutService,\n} from '@tune-up/app';\nimport {NotificationsService} from '@tune-up/core';\nimport { LoginService, SitesService } from './services';\nimport html from './login.component.html';\nimport './login.component.css';\n\n@Component({\n  selector: 'tn-login',\n  template: html,\n  providers: [LoginService, SitesService]\n})\nexport class LoginComponent {\n  model = {\n    email: undefined,\n    password: undefined,\n    idsitio: undefined\n  };\n  @ViewChild('emailCtrl') emailCtrl;\n  constructor(\n    route: ActivatedRoute,\n    router: Router,\n    loginService: LoginService,\n    sitesService: SitesService,\n    authService: AuthService,\n    agentService: AgentService,\n    aboutService: AboutService,\n    notificationsService: NotificationsService\n  ) {\n    this._returnUrl = '/example';\n    this.sites = [];\n    this._route = route;\n    this._router = router;\n    this._loginService = loginService;\n    this._sitesService = sitesService;\n    this._authService = authService;\n    this._aboutService = aboutService;\n    this._agentService = agentService;\n    this._notificationsService = notificationsService;\n  }\n  _checkLogedIn() {\n    if (this._authService.getToken()) {\n      this._redirect();\n    }\n  }\n  _redirect() {\n    this._router.navigateByUrl(this._returnUrl);\n  }\n  ngOnInit() {\n    this._returnUrl =\n      this._route.snapshot.queryParams.returnUrl || this._returnUrl;\n    this._checkLogedIn();\n  }\n  onEmailFocusLost = () => {\n    this.model.email && this.emailCtrl.valid &&\n      this._sitesService.get(this.model.email).subscribe(\n        data => {\n          const { Resultado } = data;\n          // TODO: refactor when backend api is refactored\n          if (Resultado.length === 0) {\n            this._notificationsService.error(\n              'No hay sitios disponibles',\n              'No existen sitios asociados con este email.'\n            );\n          } else {\n            this._parseSites(Resultado);\n          }\n        },\n        error => {\n          this._notificationsService.error('Error', error.Message);\n        }\n      );\n  };\n  _parseSites(sites) {\n    this.sites = sites.map(site => {\n      return { label: `${site.Id}: ${site.Nombre} `, value: site.Id };\n    });\n    this.model.idsitio = sites[0] && sites[0].Id;\n  }\n  setIdSitio = idSitio => {\n    this.model.idsitio = idSitio;\n  };\n  showSelector = () => {\n    return this.sites.length > 1;\n  };\n  login = () => {\n    this._loginService.login(this.model).subscribe(\n      data => {\n        // TODO: refactor when backend api is refactored\n        if (!data.Exito) {\n          this._notificationsService.error('Error de login', data.Mensaje);\n          return;\n        }\n        let { Token, Agente, Configuracion } = data.Resultado;\n        this._authService.setToken(Token);\n        this._agentService.agent = Agente;\n        this._aboutService.about = Configuracion;\n        this._redirect();\n      },\n      error => {\n        this._notificationsService.error('Error de login', error.Message);\n      }\n    );\n  };\n}\n","import {RouterModule} from '@angular/router';\r\nimport {NgModule} from '@angular/core';\r\nimport {LoginComponent} from './login.component';\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild([{path: '', component: LoginComponent}])],\r\n  exports: [RouterModule]\r\n})\r\nexport class LoginRoutingModule {}\r\n","import {Component, Input, Output, EventEmitter} from '@angular/core';\r\nimport html from './siteselector.component.html';\r\n\r\n@Component({\r\n  selector: 'tn-site-selector',\r\n  template: html\r\n})\r\nexport class SiteSelectorComponent {\r\n  @Input() sites = [];\r\n  @Output() onSiteSelected = new EventEmitter();\r\n  selectSite = event => {\r\n    this.onSiteSelected.emit(event.value);\r\n  };\r\n}\r\n","import {NgModule} from '@angular/core';\r\nimport {LoginRoutingModule} from './login.routing';\r\nimport {LoginComponent} from './login.component';\r\nimport {SiteSelectorComponent} from './components';\r\nimport {TuneUpCoreModule} from '@tune-up/core';\r\n\r\n@NgModule({\r\n  imports: [TuneUpCoreModule, LoginRoutingModule],\r\n  declarations: [LoginComponent, SiteSelectorComponent]\r\n})\r\nexport class LoginModule {}\r\n"],"names":["validations","configService","addValidations","LoginService","Injectable","http","_http","_url","model","post","HttpClient","SitesService","email","get","LoginComponent","Component","html","ViewChild","route","router","loginService","sitesService","authService","agentService","aboutService","notificationsService","undefined","onEmailFocusLost","emailCtrl","valid","_sitesService","subscribe","Resultado","data","length","_notificationsService","error","_parseSites","Message","setIdSitio","idsitio","idSitio","showSelector","sites","login","_loginService","Exito","Mensaje","Token","Agente","Configuracion","_authService","setToken","_agentService","agent","_aboutService","about","_redirect","_returnUrl","_route","_router","getToken","navigateByUrl","snapshot","queryParams","returnUrl","_checkLogedIn","map","label","site","Id","Nombre","value","ActivatedRoute","Router","AuthService","AgentService","AboutService","NotificationsService","LoginRoutingModule","NgModule","RouterModule","forChild","path","component","SiteSelectorComponent","Input","Output","selectSite","onSiteSelected","emit","event","EventEmitter","LoginModule","TuneUpCoreModule"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAO,IAAMA,cAAc;SAClB;WACE,CACL;eACW;iBACE;;KAHR,EAML;gBACY;iBACC;;KARR,CADF;cAaK,CACR;gBACY;iBACC;;KAHL;;CAdP;;ACGPC,cAAcC,cAAd,CAA6BF,WAA7B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACHA,IAIaG,YAAb,aADCC,YACD;wBACcC,OAAZ,EAA8B;;;SACvBC,KAAL,GAAaD,OAAb;SACKE,IAAL,GAAY,QAAZ;;;;;0BAEIC,KALR,EAKe;aACJ,KAAKF,KAAL,CAAWG,IAAX,CAAgB,KAAKF,IAArB,EAA2BC,KAA3B,CAAP;;;;;6CALgBE,aADPP;;;;;ACJb,IAIaQ,YAAb,aADCP,YACD;wBACcC,OAAZ,EAA8B;;;SACvBC,KAAL,GAAaD,OAAb;SACKE,IAAL,GAAY,QAAZ;;;;;2BAEEK,KALN,EAKa;aACF,KAAKN,KAAL,CAAWO,GAAX,CAAkB,KAAKN,IAAvB,UAAgCK,KAAhC,CAAP;;;;;6CALgBF,aADPC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ICaAG,cAAb,aALCC,UAAU;YACC,UADD;YAECC,IAFD;aAGE,CAACb,YAAD,EAAeQ,YAAf;CAHZ,CAKD,UAMGM,UAAU,WAAV,CANH;0BAQIC,KADF,EAEEC,SAFF,EAGEC,YAHF,EAIEC,YAJF,EAKEC,WALF,EAMEC,YANF,EAOEC,YAPF,EAQEC,oBARF,EASE;;;;SAfFjB,KAeE,GAfM;aACCkB,SADD;gBAEIA,SAFJ;eAGGA;KAYT;;;;SAyBFC,gBAzBE,GAyBiB,YAAM;YAClBnB,KAAL,CAAWI,KAAX,IAAoB,MAAKgB,SAAL,CAAeC,KAAnC,IACE,MAAKC,aAAL,CAAmBjB,GAAnB,CAAuB,MAAKL,KAAL,CAAWI,KAAlC,EAAyCmB,SAAzC,CACE,gBAAQ;YACEC,SADF,GACgBC,IADhB,CACED,SADF;;;YAGFA,UAAUE,MAAV,KAAqB,CAAzB,EAA4B;gBACrBC,qBAAL,CAA2BC,KAA3B,CACE,2BADF,EAEE,6CAFF;SADF,MAKO;gBACAC,WAAL,CAAiBL,SAAjB;;OAVN,EAaE,iBAAS;cACFG,qBAAL,CAA2BC,KAA3B,CAAiC,OAAjC,EAA0CA,MAAME,OAAhD;OAdJ,CADF;KA1BA;;SAmDFC,UAnDE,GAmDW,mBAAW;YACjB/B,KAAL,CAAWgC,OAAX,GAAqBC,OAArB;KApDA;;SAsDFC,YAtDE,GAsDa,YAAM;aACZ,MAAKC,KAAL,CAAWT,MAAX,GAAoB,CAA3B;KAvDA;;SAyDFU,KAzDE,GAyDM,YAAM;YACPC,aAAL,CAAmBD,KAAnB,CAAyB,MAAKpC,KAA9B,EAAqCuB,SAArC,CACE,gBAAQ;;YAEF,CAACE,KAAKa,KAAV,EAAiB;gBACVX,qBAAL,CAA2BC,KAA3B,CAAiC,gBAAjC,EAAmDH,KAAKc,OAAxD;;;8BAGqCd,KAAKD,SANtC;YAMAgB,KANA,mBAMAA,KANA;YAMOC,MANP,mBAMOA,MANP;YAMeC,aANf,mBAMeA,aANf;;cAODC,YAAL,CAAkBC,QAAlB,CAA2BJ,KAA3B;cACKK,aAAL,CAAmBC,KAAnB,GAA2BL,MAA3B;cACKM,aAAL,CAAmBC,KAAnB,GAA2BN,aAA3B;cACKO,SAAL;OAXJ,EAaE,iBAAS;cACFtB,qBAAL,CAA2BC,KAA3B,CAAiC,gBAAjC,EAAmDA,MAAME,OAAzD;OAdJ;KA1DA;;SACKoB,UAAL,GAAkB,UAAlB;SACKf,KAAL,GAAa,EAAb;SACKgB,MAAL,GAAczC,KAAd;SACK0C,OAAL,GAAezC,SAAf;SACK0B,aAAL,GAAqBzB,YAArB;SACKU,aAAL,GAAqBT,YAArB;SACK8B,YAAL,GAAoB7B,WAApB;SACKiC,aAAL,GAAqB/B,YAArB;SACK6B,aAAL,GAAqB9B,YAArB;SACKY,qBAAL,GAA6BV,oBAA7B;;;;;oCAEc;UACV,KAAK0B,YAAL,CAAkBU,QAAlB,EAAJ,EAAkC;aAC3BJ,SAAL;;;;;gCAGQ;WACLG,OAAL,CAAaE,aAAb,CAA2B,KAAKJ,UAAhC;;;;+BAES;WACJA,UAAL,GACE,KAAKC,MAAL,CAAYI,QAAZ,CAAqBC,WAArB,CAAiCC,SAAjC,IAA8C,KAAKP,UADrD;WAEKQ,aAAL;;;;gCAsBUvB,KA7Dd,EA6DqB;WACZA,KAAL,GAAaA,MAAMwB,GAAN,CAAU,gBAAQ;eACtB,EAAEC,OAAUC,KAAKC,EAAf,UAAsBD,KAAKE,MAA3B,MAAF,EAAwCC,OAAOH,KAAKC,EAApD,EAAP;OADW,CAAb;WAGK9D,KAAL,CAAWgC,OAAX,GAAqBG,MAAM,CAAN,KAAYA,MAAM,CAAN,EAAS2B,EAA1C;;;;;;;gBA3DsB1C,SAN1B;;;6CAQW6C,gBACCC,QACMvE,cACAQ,cACDgE,aACCC,cACAC,cACQC,uBAfbhE;;;;;ACjBb,IAQaiE,kBAAb,aAJCC,SAAS;WACC,CAACC,aAAaC,QAAb,CAAsB,CAAC,EAACC,MAAM,EAAP,EAAWC,WAAWtE,cAAtB,EAAD,CAAtB,CAAD,CADD;WAEC,CAACmE,YAAD;CAFV,CAID;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ICDaI,qBAAb,aAJCtE,UAAU;YACC,kBADD;YAECC;CAFX,CAID,YACGsE,OADH,UAEGC,QAFH;;;;;;;;;OAGEC,UAHF,GAGe,iBAAS;UACfC,cAAL,CAAoBC,IAApB,CAAyBC,MAAMnB,KAA/B;GAJJ;;;;WACmB,EADnB;;;;;WAE6B,IAAIoB,YAAJ,EAF7B;;;;;;;ACPA,IAUaC,WAAb,WAJCb,SAAS;WACC,CAACc,gBAAD,EAAmBf,kBAAnB,CADD;gBAEM,CAACjE,cAAD,EAAiBuE,qBAAjB;CAFf,CAID;;;;;;"}