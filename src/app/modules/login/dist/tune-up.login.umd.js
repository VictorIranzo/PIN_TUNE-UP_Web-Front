!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@tune-up/core"),require("@angular/core"),require("@angular/router"),require("@tune-up/app"),require("@angular/common/http")):"function"==typeof define&&define.amd?define(["exports","@tune-up/core","@angular/core","@angular/router","@tune-up/app","@angular/common/http"],t):t((e.tuneUp=e.tuneUp||{},e.tuneUp.login={}),e.tuneUp.app,e.tuneUp.vendor.ngCore,e.tuneUp.vendor.ngRouter,e.tuneUp.app,e.tuneUp.vendor.ngCommonHttp)}(this,function(e,t,i,n,o,r){"use strict";function _initDefineProp(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function _initDefineProp$1(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function _applyDecoratedDescriptor$1(e,t,i,n,o){var r={};return Object.keys(n).forEach(function(e){r[e]=n[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},r),o&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(o):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var l={login:{email:[{isEmail:{message:"Debe ser un email válido"}},{required:{message:"El email es requerido"}}],password:[{required:{message:"La contraseña es requerida"}}]}};t.configService.addValidations(l);!function(){function AwaitValue(e){this.value=e}function AsyncGenerator(e){function resume(t,i){try{var n=e[t](i),o=n.value;o instanceof AwaitValue?Promise.resolve(o.value).then(function(e){resume("next",e)},function(e){resume("throw",e)}):settle(n.done?"return":"normal",n.value)}catch(e){settle("throw",e)}}function settle(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?resume(t.key,t.arg):i=null}var t,i;this._invoke=function send(e,n){return new Promise(function(o,r){var l={key:e,arg:n,resolve:o,reject:r,next:null};i?i=i.next=l:(t=i=l,resume(e,n))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(AsyncGenerator.prototype[Symbol.asyncIterator]=function(){return this}),AsyncGenerator.prototype.next=function(e){return this._invoke("next",e)},AsyncGenerator.prototype.throw=function(e){return this._invoke("throw",e)},AsyncGenerator.prototype.return=function(e){return this._invoke("return",e)}}();var a,s,u=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}(),d=(a=i.Injectable())(s=function(){function LoginService(e){u(this,LoginService),this._http=e,this._url="Login2"}return c(LoginService,[{key:"login",value:function login(e){return this._http.post(this._url,e)}}]),LoginService}())||s;Reflect.defineMetadata("design:paramtypes",[r.HttpClient],d);var p,g,f=(p=i.Injectable())(g=function(){function SitesService(e){u(this,SitesService),this._http=e,this._url="Sitios"}return c(SitesService,[{key:"get",value:function get$$1(e){return this._http.get(this._url+"\\"+e)}}]),SitesService}())||g;Reflect.defineMetadata("design:paramtypes",[r.HttpClient],f);!function __$styleInject(e,t){if("undefined"==typeof document)return t;e=e||"";var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");return n.type="text/css",i.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),t}(".tn-login-background{background:url(assets/bg.jpg);background-size:cover;background-color:#1976d2;background-repeat:no-repeat;color:#fff}.tn-login-background,.tn-login-form{position:absolute;top:0;right:0;width:100%;height:100%}.tn-login-form{align-items:center;padding:100px 50px;box-shadow:0 5px 7px 5px rgba(0,0,0,.1);box-sizing:border-box;background-color:#fff;overflow:auto}@media (min-width:960px){.tn-login-form{width:fit-content}}.tn-login--header{width:180px;height:180px;padding-bottom:32px}.tn-login-form-wrapper{width:270px}.tn-login-form-inputgroup{padding-bottom:32px}.tn-login-form-inputgroup--input{width:100%}.tn-login-form--siteselector{margin-right:8px}.tn-login-form--submitbtn{height:100%}.tn-login-form--loadingbar{width:100%}",void 0);var h,m,v,b,S,_=(h=i.Component({selector:"tn-login",template:'<div class="tn-login-background">\n  <form class="vertical tn-login-form" #frm="ngForm" (ngSubmit)="frm.valid && login()">\n    <img class="tn-login--header" src="assets/logo.png">\n    <div class="tn-login-form-wrapper">\n     \n      <div class="tn-login-form-inputgroup">\n        <span class="ui-float-label">\n          <input class="tn-login-form-inputgroup--input" type="text" [(ngModel)]="model.email" rule="login.email" name="email" #emailCtrl="ngModel" (focusout)="onEmailFocusLost()"\n          pInputText>\n          <label>Email *</label>\n        </span>\n        <tn-validation-error [control]="emailCtrl"></tn-validation-error>\n      </div>\n\n      <div class="tn-login-form-inputgroup">\n        <span class="ui-float-label">\n          <input class="tn-login-form-inputgroup--input" type="password" [(ngModel)]="model.password" rule="login.password" name="password" #passwordCtrl="ngModel" pInputText>\n          <label>Contraseña *</label>\n        </span>\n        <tn-validation-error [control]="passwordCtrl"></tn-validation-error>\n      </div>\n\n      <div class="horizontal">\n        <div class="one tn-login-form--siteselector">\n          <tn-site-selector [sites]="sites" *ngIf="showSelector()" (onSiteSelected)="setIdSitio($event)"></tn-site-selector>\n        </div>\n        <button class="none tn-login-form--submitbtn" pButton type="submit" label="Login"></button>\n      </div>\n    </div>\n    <div class="horizontal">\n      <div class="tn-login-form--loadingbar">\n        <p-progressBar mode="indeterminate" showValue="loginInProgress" [style]="{\'height\': \'6px\'}"></p-progressBar>\n      </div>\n    </div>\n    \n  </form>\n</div>\n',providers:[d,f]}),m=i.ViewChild("emailCtrl"),h((b=function(){function LoginComponent(e,t,i,n,o,r,l,a){var s=this;u(this,LoginComponent),this.model={email:void 0,password:void 0,idsitio:void 0},this.sites=[],this.loginInProgress=!1,this._returnUrl="/home",_initDefineProp(this,"emailCtrl",S,this),this.onEmailFocusLost=function(){s.model.email&&s.emailCtrl.valid&&(s._getSitesSubscription=s._sitesService.get(s.model.email).subscribe(function(e){e.length>0&&s._parseSites(e)},function(e){s._notificationsService.error("No se pudieron encontrar sitios",e)}))},this.login=function(){s.loginInProgress=!0,s._loginSubscription=s._loginService.login(s.model).subscribe(function(e){s.loginInProgress=!1;var t=e.Token,i=e.Agente,n=e.Configuracion;i.IdSitio=s.model.idsitio,s._authService.setToken(t),s._agentService.agent=i,s._aboutService.about=n,s._redirect()},function(e){s.loginInProgress=!1,s._handleInvalidLogin()})},this.setIdSitio=function(e){s.model.idsitio=e},this.showSelector=function(){return s.sites.length>1},this._route=e,this._router=t,this._loginService=i,this._sitesService=n,this._authService=o,this._aboutService=l,this._agentService=r,this._notificationsService=a}return c(LoginComponent,[{key:"ngOnInit",value:function ngOnInit(){this._setDefaulReturnUrl(),this._checkLogedIn()}},{key:"_setDefaulReturnUrl",value:function _setDefaulReturnUrl(){var e=this._route.snapshot.queryParams.returnUrl;this._returnUrl=e&&"/login"!==e&&"/"!==e?e:this._returnUrl}},{key:"_checkLogedIn",value:function _checkLogedIn(){this._authService.getToken()&&this._redirect()}},{key:"_redirect",value:function _redirect(){this._router.navigateByUrl(this._returnUrl)}},{key:"_parseSites",value:function _parseSites(e){this.sites=e.map(function(e){return{label:e.Nombre,value:e.Id}}),this.model.idsitio=e[0]&&e[0].Id}},{key:"_handleInvalidLogin",value:function _handleInvalidLogin(){this._notificationsService.error("Error de login","El email o la contraseña es inválido")}},{key:"ngOnDestroy",value:function ngOnDestroy(){this._getSitesSubscription&&!this._getSitesSubscription.closed&&this._getSitesSubscription.unsubscribe(),this._loginSubscription&&!this._loginSubscription.closed&&this._loginSubscription.unsubscribe()}}]),LoginComponent}(),S=function _applyDecoratedDescriptor(e,t,i,n,o){var r={};return Object.keys(n).forEach(function(e){r[e]=n[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},r),o&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(o):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}(b.prototype,"emailCtrl",[m],{enumerable:!0,initializer:function initializer(){return this.emailCtrl}}),v=b))||v);Reflect.defineMetadata("design:paramtypes",[n.ActivatedRoute,n.Router,d,f,o.AuthService,o.AgentService,o.AboutService,t.NotificationsService],_);var y,w,k,x,C,I,z,L,P,D,M,U=(y=i.NgModule({imports:[n.RouterModule.forChild([{path:"",component:_}])],exports:[n.RouterModule]}))(w=function LoginRoutingModule(){u(this,LoginRoutingModule)})||w,j=(k=i.Component({selector:"tn-site-selector",template:'<p-dropdown [options]="sites" [filter]="true" (onChange)="selectSite($event)"></p-dropdown>\n'}),x=i.Input(),C=i.Output(),k((z=function SiteSelectorComponent(){var e=this;u(this,SiteSelectorComponent),_initDefineProp$1(this,"sites",L,this),_initDefineProp$1(this,"onSiteSelected",P,this),this.selectSite=function(t){e.onSiteSelected.emit(t.value)}},L=_applyDecoratedDescriptor$1(z.prototype,"sites",[x],{enumerable:!0,initializer:function initializer(){return[]}}),P=_applyDecoratedDescriptor$1(z.prototype,"onSiteSelected",[C],{enumerable:!0,initializer:function initializer(){return new i.EventEmitter}}),I=z))||I),E=(D=i.NgModule({imports:[t.TuneUpCoreModule,U],declarations:[_,j]}))(M=function LoginModule(){u(this,LoginModule)})||M;e.LoginModule=E,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=tune-up.login.umd.js.map
