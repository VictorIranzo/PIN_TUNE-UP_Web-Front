{"version":3,"file":"tune-up.login.umd.js","sources":["../src/config/validations.js","../src/config/config.js","../src/services/login.service.js","../src/services/sites.service.js","../src/login.component.js","../src/login.routing.js","../src/components/siteselector/siteselector.component.js","../src/login.module.js"],"sourcesContent":["export const validations = {\n  login: {\n    email: [\n      {\n        isEmail: {\n          message: 'Debe ser un email válido',\n        },\n      },\n      {\n        required: {\n          message: 'El email es requerido',\n        },\n      },\n    ],\n    password: [\n      {\n        required: {\n          message: 'La contraseña es requerida',\n        },\n      },\n    ],\n  },\n};\n","import {configService} from '@tune-up/core';\nimport {validations} from './validations';\n\nconfigService.addValidations(validations);\n","import {Injectable} from '@angular/core';\nimport {HttpClient} from '@angular/common/http';\n\n@Injectable()\nexport class LoginService {\n  constructor(http: HttpClient) {\n    this._http = http;\n    this._url = 'Login2';\n  }\n  login(model) {\n    return this._http.post(this._url, model);\n  }\n}\n","import {Injectable} from '@angular/core';\nimport {HttpClient} from '@angular/common/http';\n\n@Injectable()\nexport class SitesService {\n  constructor(http: HttpClient) {\n    this._http = http;\n    this._url = 'Sitios';\n  }\n  get(email) {\n    return this._http.get(`${this._url}\\\\${email}`);\n  }\n}\n","import {Router, ActivatedRoute} from '@angular/router';\nimport {Component, ViewChild} from '@angular/core';\nimport {AuthService, AgentService, AboutService} from '@tune-up/app';\nimport {NotificationsService} from '@tune-up/core';\nimport {LoginService, SitesService} from './services';\nimport html from './login.component.html';\nimport './login.component.css';\n\n@Component({\n  selector: 'tn-login',\n  template: html,\n  providers: [LoginService, SitesService],\n})\nexport class LoginComponent {\n  model = {\n    email: undefined,\n    password: undefined,\n    idsitio: undefined,\n  };\n  sites = [];\n  _returnUrl = '/home';\n  @ViewChild('emailCtrl') emailCtrl;\n  constructor(\n    route: ActivatedRoute,\n    router: Router,\n    loginService: LoginService,\n    sitesService: SitesService,\n    authService: AuthService,\n    agentService: AgentService,\n    aboutService: AboutService,\n    notificationsService: NotificationsService\n  ) {\n    this._route = route;\n    this._router = router;\n    this._loginService = loginService;\n    this._sitesService = sitesService;\n    this._authService = authService;\n    this._aboutService = aboutService;\n    this._agentService = agentService;\n    this._notificationsService = notificationsService;\n  }\n  ngOnInit() {\n    this._setDefaulReturnUrl();\n    this._checkLogedIn();\n  }\n  _setDefaulReturnUrl() {\n    const paramsReturnUrl = this._route.snapshot.queryParams.returnUrl;\n    this._returnUrl =\n      !paramsReturnUrl ||\n        paramsReturnUrl === '/login' ||\n        paramsReturnUrl === '/'\n        ? this._returnUrl\n        : paramsReturnUrl;\n  }\n  _checkLogedIn() {\n    if (this._authService.getToken()) {\n      this._redirect();\n    }\n  }\n  _redirect() {\n    this._router.navigateByUrl(this._returnUrl);\n  }\n  onEmailFocusLost = () => {\n    if (!this.model.email || !this.emailCtrl.valid) {\n      return;\n    }\n    this._getSitesSubscription = this._sitesService.get(this.model.email).subscribe(\n      (data) => {\n        this._handleNoSites(data);\n        data.length > 0 && this._parseSites(data);\n      },\n      (error) => {\n        this._notificationsService.error('No se pudieron encontrar sitios', error);\n      }\n    );\n  };\n  _handleNoSites(sites) {\n    sites.length === 0 &&\n      this._notificationsService.error(\n        'No hay sitios disponibles',\n        'No existen sitios asociados con este email.'\n      );\n  }\n  _parseSites(sites) {\n    this.sites = sites.map((site) => {\n      return {label: site.Nombre, value: site.Id};\n    });\n    this.model.idsitio = sites[0] && sites[0].Id;\n  }\n  login = () => {\n    this._loginSubscription = this._loginService.login(this.model).subscribe(\n      (data) => {\n        let {Token, Agente, Configuracion} = data;\n        Agente.IdSitio = this.model.idsitio;\n        this._authService.setToken(Token);\n        this._agentService.agent = Agente;\n        this._aboutService.about = Configuracion;\n        this._redirect();\n      },\n      (error) => {\n        this._notificationsService.error('Error de login', error);\n      }\n    );\n  };\n  setIdSitio = (idSitio) => {\n    this.model.idsitio = idSitio;\n  };\n  showSelector = () => {\n    return this.sites.length > 1;\n  };\n  ngOnDestroy() {\n    this._getSitesSubscription &&\n      !this._getSitesSubscription.closed &&\n      this._getSitesSubscription.unsubscribe();\n    this._loginSubscription &&\n      !this._loginSubscription.closed &&\n      this._loginSubscription.unsubscribe();\n  }\n}\n","import {RouterModule} from '@angular/router';\nimport {NgModule} from '@angular/core';\nimport {LoginComponent} from './login.component';\n\n@NgModule({\n  imports: [RouterModule.forChild([{path: '', component: LoginComponent}])],\n  exports: [RouterModule],\n})\nexport class LoginRoutingModule {}\n","import {Component, Input, Output, EventEmitter} from '@angular/core';\nimport html from './siteselector.component.html';\n\n@Component({\n  selector: 'tn-site-selector',\n  template: html,\n})\nexport class SiteSelectorComponent {\n  @Input() sites = [];\n  @Output() onSiteSelected = new EventEmitter();\n  selectSite = (event) => {\n    this.onSiteSelected.emit(event.value);\n  };\n}\n","import {NgModule} from '@angular/core';\nimport {LoginRoutingModule} from './login.routing';\nimport {LoginComponent} from './login.component';\nimport {SiteSelectorComponent} from './components';\nimport {TuneUpCoreModule} from '@tune-up/core';\n\n@NgModule({\n  imports: [TuneUpCoreModule, LoginRoutingModule],\n  declarations: [LoginComponent, SiteSelectorComponent],\n})\nexport class LoginModule {}\n"],"names":["validations","configService","addValidations","LoginService","Injectable","http","_http","_url","model","post","HttpClient","SitesService","email","get","LoginComponent","Component","html","ViewChild","route","router","loginService","sitesService","authService","agentService","aboutService","notificationsService","undefined","sites","_returnUrl","onEmailFocusLost","emailCtrl","valid","_getSitesSubscription","_sitesService","subscribe","data","_handleNoSites","length","_parseSites","error","_notificationsService","login","_loginSubscription","_loginService","Token","Agente","Configuracion","IdSitio","idsitio","_authService","setToken","_agentService","agent","_aboutService","about","_redirect","setIdSitio","idSitio","showSelector","_route","_router","_setDefaulReturnUrl","_checkLogedIn","paramsReturnUrl","snapshot","queryParams","returnUrl","getToken","navigateByUrl","map","site","label","Nombre","value","Id","closed","unsubscribe","ActivatedRoute","Router","AuthService","AgentService","AboutService","NotificationsService","LoginRoutingModule","NgModule","RouterModule","forChild","path","component","SiteSelectorComponent","Input","Output","selectSite","event","onSiteSelected","emit","EventEmitter","LoginModule","TuneUpCoreModule"],"mappings":"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"}