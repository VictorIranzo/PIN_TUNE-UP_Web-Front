{"version":3,"file":"tune-up.login.umd.js","sources":["../src/config/validations.js","../src/config/config.js","../src/services/login.service.js","../src/services/sites.service.js","../src/login.component.js","../src/login.routing.js","../src/components/siteselector/siteselector.component.js","../src/login.module.js"],"sourcesContent":["export const validations = {\n  login: {\n    email: [\n      {\n        isEmail: {\n          message: 'Debe ser un email válido',\n        },\n      },\n      {\n        required: {\n          message: 'El email es requerido',\n        },\n      },\n    ],\n    password: [\n      {\n        required: {\n          message: 'La contraseña es requerida',\n        },\n      },\n    ],\n  },\n};\n","import {configService} from '@tune-up/core';\nimport {validations} from './validations';\n\nconfigService.addValidations(validations);\n","import {Injectable} from '@angular/core';\nimport {HttpClient} from '@angular/common/http';\n\n@Injectable()\nexport class LoginService {\n  constructor(http: HttpClient) {\n    this._http = http;\n    this._url = 'Login2';\n  }\n  login(model) {\n    return this._http.post(this._url, model);\n  }\n}\n","import {Injectable} from '@angular/core';\nimport {HttpClient} from '@angular/common/http';\n\n@Injectable()\nexport class SitesService {\n  constructor(http: HttpClient) {\n    this._http = http;\n    this._url = 'Sitios';\n  }\n  get(email) {\n    return this._http.get(`${this._url}\\\\${email}`);\n  }\n}\n","import {Router, ActivatedRoute} from '@angular/router';\nimport {Component, ViewChild} from '@angular/core';\nimport {AuthService, AgentService, AboutService} from '@tune-up/app';\nimport {NotificationsService} from '@tune-up/core';\nimport {LoginService, SitesService} from './services';\nimport html from './login.component.html';\nimport './login.component.css';\n\n@Component({\n  selector: 'tn-login',\n  template: html,\n  providers: [LoginService, SitesService],\n})\nexport class LoginComponent {\n  model = {\n    email: undefined,\n    password: undefined,\n    idsitio: undefined,\n  };\n  sites = [];\n  _returnUrl = '/home';\n  @ViewChild('emailCtrl') emailCtrl;\n  constructor(\n    route: ActivatedRoute,\n    router: Router,\n    loginService: LoginService,\n    sitesService: SitesService,\n    authService: AuthService,\n    agentService: AgentService,\n    aboutService: AboutService,\n    notificationsService: NotificationsService\n  ) {\n    this._route = route;\n    this._router = router;\n    this._loginService = loginService;\n    this._sitesService = sitesService;\n    this._authService = authService;\n    this._aboutService = aboutService;\n    this._agentService = agentService;\n    this._notificationsService = notificationsService;\n  }\n  _checkLogedIn() {\n    if (this._authService.getToken()) {\n      this._redirect();\n    }\n  }\n  _redirect() {\n    this._router.navigateByUrl(this._returnUrl);\n  }\n  ngOnInit() {\n    const paramsReturnUrl = this._route.snapshot.queryParams.returnUrl;\n    this._returnUrl =\n      !paramsReturnUrl ||\n      paramsReturnUrl === '/login' ||\n      paramsReturnUrl === '/'\n        ? this._returnUrl\n        : paramsReturnUrl;\n    this._checkLogedIn();\n  }\n  onEmailFocusLost = () => {\n    this.model.email &&\n      this.emailCtrl.valid &&\n      this._sitesService.get(this.model.email).subscribe(\n        (data) => {\n          const {Resultado} = data;\n          // TODO: refactor when backend api is refactored\n          if (Resultado.length === 0) {\n            this._notificationsService.error(\n              'No hay sitios disponibles',\n              'No existen sitios asociados con este email.'\n            );\n          } else {\n            this._parseSites(Resultado);\n          }\n        },\n        (error) => {\n          this._notificationsService.error('Error', error);\n        }\n      );\n  };\n  _parseSites(sites) {\n    this.sites = sites.map((site) => {\n      return {label: `${site.Id}: ${site.Nombre} `, value: site.Id};\n    });\n    this.model.idsitio = sites[0] && sites[0].Id;\n  }\n  setIdSitio = (idSitio) => {\n    this.model.idsitio = idSitio;\n  };\n  showSelector = () => {\n    return this.sites.length > 1;\n  };\n  login = () => {\n    this._loginService.login(this.model).subscribe(\n      (data) => {\n        // TODO: refactor when backend api is refactored\n        if (!data.Exito) {\n          this._notificationsService.error('Error de login', data.Mensaje);\n          return;\n        }\n        let {Token, Agente, Configuracion} = data.Resultado;\n        Agente.IdSitio = this.model.idsitio;\n        this._authService.setToken(Token);\n        this._agentService.agent = Agente;\n        this._aboutService.about = Configuracion;\n        this._redirect();\n      },\n      (error) => {\n        this._notificationsService.error('Error de login', error);\n      }\n    );\n  };\n}\n","import {RouterModule} from '@angular/router';\nimport {NgModule} from '@angular/core';\nimport {LoginComponent} from './login.component';\n\n@NgModule({\n  imports: [RouterModule.forChild([{path: '', component: LoginComponent}])],\n  exports: [RouterModule],\n})\nexport class LoginRoutingModule {}\n","import {Component, Input, Output, EventEmitter} from '@angular/core';\nimport html from './siteselector.component.html';\n\n@Component({\n  selector: 'tn-site-selector',\n  template: html,\n})\nexport class SiteSelectorComponent {\n  @Input() sites = [];\n  @Output() onSiteSelected = new EventEmitter();\n  selectSite = (event) => {\n    this.onSiteSelected.emit(event.value);\n  };\n}\n","import {NgModule} from '@angular/core';\nimport {LoginRoutingModule} from './login.routing';\nimport {LoginComponent} from './login.component';\nimport {SiteSelectorComponent} from './components';\nimport {TuneUpCoreModule} from '@tune-up/core';\n\n@NgModule({\n  imports: [TuneUpCoreModule, LoginRoutingModule],\n  declarations: [LoginComponent, SiteSelectorComponent],\n})\nexport class LoginModule {}\n"],"names":["validations","configService","addValidations","LoginService","Injectable","http","_http","_url","model","post","HttpClient","SitesService","email","get","LoginComponent","Component","html","ViewChild","route","router","loginService","sitesService","authService","agentService","aboutService","notificationsService","undefined","sites","_returnUrl","onEmailFocusLost","emailCtrl","valid","_sitesService","subscribe","data","Resultado","length","_notificationsService","error","_parseSites","setIdSitio","idSitio","idsitio","showSelector","login","_loginService","Exito","Mensaje","Token","Agente","Configuracion","IdSitio","_authService","setToken","_agentService","agent","_aboutService","about","_redirect","_route","_router","getToken","navigateByUrl","paramsReturnUrl","snapshot","queryParams","returnUrl","_checkLogedIn","map","site","label","Id","Nombre","value","ActivatedRoute","Router","AuthService","AgentService","AboutService","NotificationsService","LoginRoutingModule","NgModule","RouterModule","forChild","path","component","SiteSelectorComponent","Input","Output","selectSite","event","onSiteSelected","emit","EventEmitter","LoginModule","TuneUpCoreModule"],"mappings":"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"}