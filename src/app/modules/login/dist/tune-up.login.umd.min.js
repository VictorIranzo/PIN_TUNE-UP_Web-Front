!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@tune-up/core"),require("@angular/core"),require("@angular/router"),require("@tune-up/app"),require("@angular/common/http")):"function"==typeof define&&define.amd?define(["exports","@tune-up/core","@angular/core","@angular/router","@tune-up/app","@angular/common/http"],t):t((e.tuneUp=e.tuneUp||{},e.tuneUp.login={}),e.tuneUp.app,e.tuneUp.vendor.ngCore,e.tuneUp.vendor.ngRouter,e.tuneUp.app,e.tuneUp.vendor.ngCommonHttp)}(this,function(e,t,n,i,o,r){"use strict";function _initDefineProp(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function _applyDecoratedDescriptor(e,t,n,i,o){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=n.slice().reverse().reduce(function(n,i){return i(e,t,n)||n},r),o&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(o):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var u={login:{email:[{isEmail:{message:"Debe ser un email v√°lido"}}]}};t.configService.addValidations(u);!function(){function AwaitValue(e){this.value=e}function AsyncGenerator(e){function resume(t,n){try{var i=e[t](n),o=i.value;o instanceof AwaitValue?Promise.resolve(o.value).then(function(e){resume("next",e)},function(e){resume("throw",e)}):settle(i.done?"return":"normal",i.value)}catch(e){settle("throw",e)}}function settle(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?resume(t.key,t.arg):n=null}var t,n;this._invoke=function send(e,i){return new Promise(function(o,r){var u={key:e,arg:i,resolve:o,reject:r,next:null};n?n=n.next=u:(t=n=u,resume(e,i))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(AsyncGenerator.prototype[Symbol.asyncIterator]=function(){return this}),AsyncGenerator.prototype.next=function(e){return this._invoke("next",e)},AsyncGenerator.prototype.throw=function(e){return this._invoke("throw",e)},AsyncGenerator.prototype.return=function(e){return this._invoke("return",e)}}();var l,s,a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),p=(l=n.Injectable())(s=function(){function LoginService(e){a(this,LoginService),this._http=e,this._url="Login2"}return c(LoginService,[{key:"login",value:function login(e){return this._http.post(this._url,e)}}]),LoginService}())||s;Reflect.defineMetadata("design:paramtypes",[r.HttpClient],p);var d,f,m=(d=n.Injectable())(f=function(){function SitesService(e){a(this,SitesService),this._http=e,this._url="Sitios"}return c(SitesService,[{key:"get",value:function get$$1(e){return this._http.get(this._url+"\\"+e)}}]),SitesService}())||f;Reflect.defineMetadata("design:paramtypes",[r.HttpClient],m);!function __$styleInject(e,t){if("undefined"==typeof document)return t;e=e||"";var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");return i.type="text/css",n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),t}("",void 0);var v,h,g=(v=n.Component({selector:"tn-login",template:'<form class="vertical" #frm="ngForm" (ngSubmit)="login()">\n  <input type="text" [(ngModel)]="model.email" rule="login.email" name="email" #emailCtrl="ngModel" (focusout)="onEmailFocusLost()" pInputText>\n  <tn-error [control]="emailCtrl"></tn-error>\n  <input type="password" [(ngModel)]="model.password" name="password" pInputText>\n  <tn-site-selector [sites]="sites" *ngIf="showSelector()" (onSiteSelected)="setIdSitio($event)"></tn-site-selector>\n  <div class="horizontal">\n    <div class="one"></div>\n    <button class="none" pButton type="submit" label="Login"></button>\n  </div>\n</form>\n',providers:[p,m]}))(h=function(){function LoginComponent(e,t,n,i,o){var r=this;a(this,LoginComponent),this.model={email:void 0,password:void 0,idsitio:void 0},this.onEmailFocusLost=function(){r._sitesService.get(r.model.email).subscribe(function(e){r.sites=e.Resultado.map(function(e){return{label:e.Id+": "+e.Nombre+" ",value:e.Id}})},function(e){console.log(e)})},this.setIdSitio=function(e){r.model.idsitio=e},this.showSelector=function(){return r.sites.length>1},this.login=function(){r._loginService.login(r.model).subscribe(function(e){console.log(e),r._authService.setToken(e.Resultado.Token),r._router.navigateByUrl(r._returnUrl)},function(e){console.log(e)})},this._returnUrl="/home",this.sites=[],this._route=e,this._router=t,this._loginService=n,this._sitesService=i,this._authService=o}return c(LoginComponent,[{key:"ngOnInit",value:function ngOnInit(){this._returnUrl=this._route.snapshot.queryParams.returnUrl||this._returnUrl}}]),LoginComponent}())||h;Reflect.defineMetadata("design:paramtypes",[i.ActivatedRoute,i.Router,p,m,o.AuthService],g);var y,S,b,_,w,C,L,M,x,k,I,U=(y=n.NgModule({imports:[i.RouterModule.forChild([{path:"",component:g}])],exports:[i.RouterModule]}))(S=function LoginRoutingModule(){a(this,LoginRoutingModule)})||S,z=(b=n.Component({selector:"tn-site-selector",template:'<p-dropdown [options]="sites" [filter]="true" (onChange)="selectSite($event)"></p-dropdown>\n'}),_=n.Input(),w=n.Output(),b((L=function SiteSelectorComponent(){var e=this;a(this,SiteSelectorComponent),_initDefineProp(this,"sites",M,this),_initDefineProp(this,"onSiteSelected",x,this),this.selectSite=function(t){e.onSiteSelected.emit(t.value)}},M=_applyDecoratedDescriptor(L.prototype,"sites",[_],{enumerable:!0,initializer:function initializer(){return[]}}),x=_applyDecoratedDescriptor(L.prototype,"onSiteSelected",[w],{enumerable:!0,initializer:function initializer(){return new n.EventEmitter}}),C=L))||C),P=(k=n.NgModule({imports:[t.TuneUpCoreModule,U],declarations:[g,z]}))(I=function LoginModule(){a(this,LoginModule)})||I;e.LoginModule=P,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=tune-up.login.umd.min.js.map
