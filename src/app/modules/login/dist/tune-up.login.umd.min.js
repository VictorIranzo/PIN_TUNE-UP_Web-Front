!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@tune-up/core"),require("@angular/core"),require("@angular/router"),require("@tune-up/app"),require("@angular/common/http")):"function"==typeof define&&define.amd?define(["exports","@tune-up/core","@angular/core","@angular/router","@tune-up/app","@angular/common/http"],t):t((e.tuneUp=e.tuneUp||{},e.tuneUp.login={}),e.tuneUp.app,e.tuneUp.vendor.ngCore,e.tuneUp.vendor.ngRouter,e.tuneUp.app,e.tuneUp.vendor.ngCommonHttp)}(this,function(e,t,i,n,r,o){"use strict";function _initDefineProp(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function _initDefineProp$1(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function _applyDecoratedDescriptor$1(e,t,i,n,r){var o={};return Object.keys(n).forEach(function(e){o[e]=n[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var a={login:{email:[{isEmail:{message:"Debe ser un email válido"}},{required:{message:"El email es requerido"}}],password:[{required:{message:"La contraseña es requerida"}}]}};t.configService.addValidations(a);!function(){function AwaitValue(e){this.value=e}function AsyncGenerator(e){function resume(t,i){try{var n=e[t](i),r=n.value;r instanceof AwaitValue?Promise.resolve(r.value).then(function(e){resume("next",e)},function(e){resume("throw",e)}):settle(n.done?"return":"normal",n.value)}catch(e){settle("throw",e)}}function settle(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?resume(t.key,t.arg):i=null}var t,i;this._invoke=function send(e,n){return new Promise(function(r,o){var a={key:e,arg:n,resolve:r,reject:o,next:null};i?i=i.next=a:(t=i=a,resume(e,n))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(AsyncGenerator.prototype[Symbol.asyncIterator]=function(){return this}),AsyncGenerator.prototype.next=function(e){return this._invoke("next",e)},AsyncGenerator.prototype.throw=function(e){return this._invoke("throw",e)},AsyncGenerator.prototype.return=function(e){return this._invoke("return",e)}}();var l,s,u=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}(),p=(l=i.Injectable())(s=function(){function LoginService(e){u(this,LoginService),this._http=e,this._url="Login2"}return c(LoginService,[{key:"login",value:function login(e){return this._http.post(this._url,e)}}]),LoginService}())||s;Reflect.defineMetadata("design:paramtypes",[o.HttpClient],p);var d,f,g=(d=i.Injectable())(f=function(){function SitesService(e){u(this,SitesService),this._http=e,this._url="Sitios"}return c(SitesService,[{key:"get",value:function get$$1(e){return this._http.get(this._url+"\\"+e)}}]),SitesService}())||f;Reflect.defineMetadata("design:paramtypes",[o.HttpClient],g);!function __$styleInject(e,t){if("undefined"==typeof document)return t;e=e||"";var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");return n.type="text/css",i.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),t}(".tn-login-background{background:url(assets/bg.jpg);background-size:cover;background-color:#1976d2;background-repeat:no-repeat;color:#fff}.tn-login-background,.tn-login-form{position:absolute;top:0;right:0;width:100%;height:100%}.tn-login-form{align-items:center;padding:100px 50px;box-shadow:0 5px 7px 5px rgba(0,0,0,.1);box-sizing:border-box;background-color:#fff;overflow:auto}@media (min-width:960px){.tn-login-form{width:fit-content}}.tn-login--header{width:180px;height:180px;padding-bottom:32px}.tn-login-form-wrapper{width:270px}.tn-login-form-inputgroup{padding-bottom:32px}.tn-login-form-inputgroup--input{width:100%}.tn-login-form--siteselector{margin-right:8px}.tn-login-form--submitbtn{height:100%}",void 0);var m,v,h,b,y,S=(m=i.Component({selector:"tn-login",template:'<div class="tn-login-background">\n  <form class="vertical tn-login-form" #frm="ngForm" (ngSubmit)="frm.valid && login()">\n    <img class="tn-login--header" src="assets/logo.png">\n    <div class="tn-login-form-wrapper">\n     \n      <div class="tn-login-form-inputgroup">\n        <span class="ui-float-label">\n          <input class="tn-login-form-inputgroup--input" type="text" [(ngModel)]="model.email" rule="login.email" name="email" #emailCtrl="ngModel" (focusout)="onEmailFocusLost()"\n          pInputText>\n          <label>Email *</label>\n        </span>\n        <tn-validation-error [control]="emailCtrl"></tn-validation-error>\n      </div>\n\n      <div class="tn-login-form-inputgroup">\n        <span class="ui-float-label">\n          <input class="tn-login-form-inputgroup--input" type="password" [(ngModel)]="model.password" rule="login.password" name="password" #passwordCtrl="ngModel" pInputText>\n          <label>Contraseña *</label>\n        </span>\n        <tn-validation-error [control]="passwordCtrl"></tn-validation-error>\n      </div>\n\n      <div class="horizontal">\n        <div class="one tn-login-form--siteselector">\n          <tn-site-selector [sites]="sites" *ngIf="showSelector()" (onSiteSelected)="setIdSitio($event)"></tn-site-selector>\n        </div>\n        <button class="none tn-login-form--submitbtn" pButton type="submit" label="Login"></button>\n      </div>\n    </div>\n  </form>\n</div>\n',providers:[p,g]}),v=i.ViewChild("emailCtrl"),m((b=function(){function LoginComponent(e,t,i,n,r,o,a,l){var s=this;u(this,LoginComponent),this.model={email:void 0,password:void 0,idsitio:void 0},_initDefineProp(this,"emailCtrl",y,this),this.onEmailFocusLost=function(){s.model.email&&s.emailCtrl.valid&&s._sitesService.get(s.model.email).subscribe(function(e){var t=e.Resultado;0===t.length?s._notificationsService.error("No hay sitios disponibles","No existen sitios asociados con este email."):s._parseSites(t)},function(e){s._notificationsService.error("Error",e.Message)})},this.setIdSitio=function(e){s.model.idsitio=e},this.showSelector=function(){return s.sites.length>1},this.login=function(){s._loginService.login(s.model).subscribe(function(e){if(e.Exito){var t=e.Resultado,i=t.Token,n=t.Agente,r=t.Configuracion;s._authService.setToken(i),s._agentService.agent=n,s._aboutService.about=r,s._redirect()}else s._notificationsService.error("Error de login",e.Mensaje)},function(e){s._notificationsService.error("Error de login",e.Message)})},this._returnUrl="/example",this.sites=[],this._route=e,this._router=t,this._loginService=i,this._sitesService=n,this._authService=r,this._aboutService=a,this._agentService=o,this._notificationsService=l}return c(LoginComponent,[{key:"_checkLogedIn",value:function _checkLogedIn(){this._authService.getToken()&&this._redirect()}},{key:"_redirect",value:function _redirect(){this._router.navigateByUrl(this._returnUrl)}},{key:"ngOnInit",value:function ngOnInit(){var e=this._route.snapshot.queryParams.returnUrl;this._returnUrl=e&&"/home"!==e?e:this._returnUrl,this._checkLogedIn()}},{key:"_parseSites",value:function _parseSites(e){this.sites=e.map(function(e){return{label:e.Id+": "+e.Nombre+" ",value:e.Id}}),this.model.idsitio=e[0]&&e[0].Id}}]),LoginComponent}(),y=function _applyDecoratedDescriptor(e,t,i,n,r){var o={};return Object.keys(n).forEach(function(e){o[e]=n[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}(b.prototype,"emailCtrl",[v],{enumerable:!0,initializer:function initializer(){return this.emailCtrl}}),h=b))||h);Reflect.defineMetadata("design:paramtypes",[n.ActivatedRoute,n.Router,p,g,r.AuthService,r.AgentService,r.AboutService,t.NotificationsService],S);var _,w,x,k,C,z,L,M,I,P,j,E=(_=i.NgModule({imports:[n.RouterModule.forChild([{path:"",component:S}])],exports:[n.RouterModule]}))(w=function LoginRoutingModule(){u(this,LoginRoutingModule)})||w,U=(x=i.Component({selector:"tn-site-selector",template:'<p-dropdown [options]="sites" [filter]="true" (onChange)="selectSite($event)"></p-dropdown>\r\n'}),k=i.Input(),C=i.Output(),x((L=function SiteSelectorComponent(){var e=this;u(this,SiteSelectorComponent),_initDefineProp$1(this,"sites",M,this),_initDefineProp$1(this,"onSiteSelected",I,this),this.selectSite=function(t){e.onSiteSelected.emit(t.value)}},M=_applyDecoratedDescriptor$1(L.prototype,"sites",[k],{enumerable:!0,initializer:function initializer(){return[]}}),I=_applyDecoratedDescriptor$1(L.prototype,"onSiteSelected",[C],{enumerable:!0,initializer:function initializer(){return new i.EventEmitter}}),z=L))||z),D=(P=i.NgModule({imports:[t.TuneUpCoreModule,E],declarations:[S,U]}))(j=function LoginModule(){u(this,LoginModule)})||j;e.LoginModule=D,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=tune-up.login.umd.min.js.map
