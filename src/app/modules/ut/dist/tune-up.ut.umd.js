!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/router"),require("@tune-up/app"),require("@angular/common/http"),require("@tune-up/core")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/router","@tune-up/app","@angular/common/http","@tune-up/core"],t):t((e.tuneUp=e.tuneUp||{},e.tuneUp.ut={}),e.tuneUp.vendor.ngCore,e.tuneUp.vendor.ngRouter,e.tuneUp.app,e.tuneUp.vendor.ngCommonHttp,e.tuneUp.app)}(this,function(e,t,o,i,r,n){"use strict";function __$styleInject(e,t){if("undefined"==typeof document)return t;e=e||"";var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");return i.type="text/css",o.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),t}__$styleInject("",void 0);!function(){function AwaitValue(e){this.value=e}function AsyncGenerator(e){function resume(t,o){try{var i=e[t](o),r=i.value;r instanceof AwaitValue?Promise.resolve(r.value).then(function(e){resume("next",e)},function(e){resume("throw",e)}):settle(i.done?"return":"normal",i.value)}catch(e){settle("throw",e)}}function settle(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?resume(t.key,t.arg):o=null}var t,o;this._invoke=function send(e,i){return new Promise(function(r,n){var s={key:e,arg:i,resolve:r,reject:n,next:null};o?o=o.next=s:(t=o=s,resume(e,i))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(AsyncGenerator.prototype[Symbol.asyncIterator]=function(){return this}),AsyncGenerator.prototype.next=function(e){return this._invoke("next",e)},AsyncGenerator.prototype.throw=function(e){return this._invoke("throw",e)},AsyncGenerator.prototype.return=function(e){return this._invoke("return",e)}}();var s,u,l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function defineProperties(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&defineProperties(e.prototype,t),o&&defineProperties(e,o),e}}(),c=(s=t.Component({selector:"tn-ut",template:"<div>Este será el módulo para la gestión global de UTs</div>\r\n"}))(u=function(){function UtComponent(e){l(this,UtComponent),this._breadcrumbService=e,this._breadcrumbService.addItems({label:"UTs",routerLink:"/uts"})}return a(UtComponent,[{key:"ngOnDestroy",value:function ngOnDestroy(){}}]),UtComponent}())||u;Reflect.defineMetadata("design:paramtypes",[i.BreadcrumbService],c);var d,p,f=(d=t.Injectable())(p=function(){function DetailsService(e){l(this,DetailsService),this._http=e,this._urlUT="FichaUT2",this._urlProductos="Productos2",this._urlUTs="UTs2"}return a(DetailsService,[{key:"getUt",value:function getUt(e){return this._http.get(this._urlUT+"/"+e)}},{key:"getProductosDisponibles",value:function getProductosDisponibles(){return this._http.get(""+this._urlProductos)}},{key:"submitChangesDetails",value:function submitChangesDetails(e){return this._http.post(this._urlUTs,e)}}]),DetailsService}())||p;Reflect.defineMetadata("design:paramtypes",[r.HttpClient],f);__$styleInject(".tn-ut__form{padding:16px}.tn-ut__form__section{padding:8px}.tn-ut__form__buttons{padding:8px;align-items:flex-end}.tn-ut__form__detail_button{height:60%}",void 0);var v,_,h={1:"fa fa-star",2:"fa fa-bug",3:"fa fa-plus-circle",4:"fa fa-puzzle-piece"},b=(v=t.Component({selector:"tn-ut-details",template:'<form class="tn-ut__form vertical" #frm="ngForm" (ngSubmit)="frm.valid && onGuardar()">\n  <div class="horizontal" flex-wrap="wrap">\n    <div class="vertical one tn-ut__form__section">\n      <label>Código</label>\n      <input id="disabled-input" type="text" pInputText [(ngModel)]= "model.IdUT" name="codigo" #codigoCtrl="ngModel" [disabled]="true"/>\n    </div>\n    <div class="vertical seven tn-ut__form__section">\n        <label>Nombre</label>\n        <input id="input" type="text" pInputText [(ngModel)]="model.Nombre" name="nombre" #nombreCtrl="ngModel" [disabled]= "!editingMode"> \n    </div>\n    <div class="horizontal two tn-ut__form__buttons">\n        <button *ngIf="!editingMode" pButton type="button" class="tn-ut__form__detail_button" label="Editar" (click)="onEditar()"></button>\n        <button *ngIf="editingMode" pButton type="submit" class="tn-ut__form__detail_button" label="Guardar"></button>\n        <button *ngIf="editingMode" pButton type="button" class="tn-ut__form__detail_button" label="Cancelar" (click)="onCancelar()"></button>\n    </div>\n  </div>\n  <div class="horizontal" flex-wrap="wrap">\n    <div class="vertical five tn-ut__form__section">\n      <label>Producto</label>\n      <p-dropdown [options]="productosDisponibles" [(ngModel)]="model.IdProducto" name="producto" #productoCtrl="ngModel" optionLabel= "IdProducto" [disabled]= "!editingMode" filter="true" [style]="{\'width\':\'100%\', \'height\':\'50%\'}"></p-dropdown>\n    </div>\n    <div class="vertical five tn-ut__form__section">\n      <label>Sprint</label>\n      <p-dropdown [options]="sprintsDisponibles" [(ngModel)]="model.IdVersion" name="sprint" #sprintCtrl="ngModel" [disabled]= "!editingMode" filter="true" [style]="{\'width\':\'100%\'}"></p-dropdown>    \n    </div>\n    <div class="vertical three tn-ut__form__section">\n        <label>Orden</label>\n        <p-spinner [step]=10 [min]=0 [(ngModel)]="model.Orden" name="orden" #ordenCtrl="ngModel" [disabled]= "!editingMode"></p-spinner> \n    </div>\n  </div>\n  <div class="horizontal" flex-wrap="wrap">\n    <div class="vertical five tn-ut__form__section">\n      <label>Workflow</label>\n      <p-dropdown [options]="workflowsDisponibles" [(ngModel)]="model.IdWorkflow" name="workflow" #workflowCtrl="ngModel" [disabled]= "!editingMode" filter="true" [style]="{\'width\':\'100%\'}"></p-dropdown>      \n    </div>  \n    <div class="vertical three tn-ut__form__section">\n        <label>Tipo</label>\n        <p-dropdown [options]="tiposDisponibles" [(ngModel)]="model.IdTipoUT" name="tipo" #tipoCtrl="ngModel" [disabled]= "!editingMode" filter="true" [style]="{\'width\':\'100%\'}">\n          <ng-template let-tipoUT pTemplate="item">\n            <div class="ui-helper-clearfix" style="position: relative;height: 25px;">\n                <i [ngClass]="getUtTypeIcon(tipoUT.value)"></i>\n                <div style="font-size:14px;float:right;margin-top:4px">{{tipoUT.label}}</div>\n            </div>\n          </ng-template>\n        </p-dropdown>\n    </div>\n    <div class="vertical five tn-ut__form__section">\n      <label>Proyecto</label>\n      <p-dropdown [options]="proyectosDisponibles" [(ngModel)]="model.IdProyecto" name="proyecto" #proyectoCtrl="ngModel" [disabled]= "!editingMode" filter="true" [style]="{\'width\':\'100%\'}"></p-dropdown>      \n    </div>\n  </div>\n  <div class="vertical tn-ut__form__section" flex-wrap="wrap">\n      <label>Descripción</label>\n      <textarea rows="5"  pInputTextarea  [(ngModel)]="model.Descripcion" name="descripcion" #descripcionCtrl="ngModel" [disabled]= "!editingMode" [style]="{\'width\':\'100%\'}"></textarea>      \n  </div>\n</form>\n'}))(_=function(){function DetailsComponent(e,t,o,i){var r=this;l(this,DetailsComponent),this.editingMode=!1,this.model={IdUT:void 0,Nombre:void 0,Orden:void 0,IdProducto:void 0,IdVersion:void 0,IdWorkflow:void 0,IdTipoUT:void 0,IdProyecto:void 0,Descripcion:void 0},this.ut=this.ut,this.onGuardar=function(){r._saveDetailsSubscription=r._detailsService.submitChangesDetails(r.model).subscribe(function(e){r.editingMode=!1,r.ut.UT.IdUT=r.model.IdUT,r.ut.UT.Nombre=r.model.Nombre,r.ut.UT.Orden=r.model.Orden,r.ut.UT.IdProducto=r.model.IdProducto,r.ut.UT.IdVersion=r.model.IdVersion,r.ut.UT.IdWorkflow=r.model.IdWorkflow,r.ut.UT.IdTipoUT=r.model.IdTipoUT,r.ut.UT.IdProyecto=r.model.IdProyecto,r.ut.UT.Descripcion=r.model.Descripcion},function(e){r._notificationsService.error("Error al guardar los cambios",e)})},this.getUtTypeIcon=function(e){return h[e]},this._route=e,this._detailsService=t,this._notificationsService=o,this._breadcrumbService=i,this.model.IdUT=parseInt(this._route.params._value.id),this._breadcrumbService.addItems({label:this.model.IdUT,routerLink:"/uts/"+this.model.IdUT}),this._detailsService.getProductosDisponibles().subscribe(function(e){r._parseProductos(e)}),this._detailsService.getUt(this.model.IdUT).subscribe(function(e){r.ut=e,r.model.Nombre=e.UT.Nombre,r.model.Orden=e.UT.Orden,r._parseSprints(e.listaVersionesUT),r._parseWorkflows(e.listaWorkflowsDisponibles),r._parseTipos(e.listaTiposUT),r._parseProyectos(e.listaProyectos),r.model.Descripcion=e.UT.Descripcion,r._mapSelected(e,r.model)})}return a(DetailsComponent,[{key:"onEditar",value:function onEditar(){this.editingMode=!0}},{key:"onCancelar",value:function onCancelar(){this.editingMode=!1,this.model.IdUT=this.ut.UT.IdUT,this.model.Nombre=this.ut.UT.Nombre,this.model.Orden=this.ut.UT.Orden,this.model.IdProducto=this.ut.UT.IdProducto,this.model.IdVersion=this.ut.UT.IdVersion,this.model.IdWorkflow=this.ut.UT.IdWorkflow,this.model.IdTipoUT=this.ut.UT.IdTipoUT,this.model.IdProyecto=this.ut.UT.IdProyecto,this.model.Descripcion=this.ut.UT.Descripcion}},{key:"_parseSprints",value:function _parseSprints(e){this.sprintsDisponibles=e.map(function(e){return{label:e.Nombre,value:e.IdVersion}}),this.sprintsDisponibles.push({label:"Backlog",value:null})}},{key:"_parseWorkflows",value:function _parseWorkflows(e){this.workflowsDisponibles=e.map(function(e){return{label:""+e.Nombre,value:e.IdWorkflow}})}},{key:"_parseTipos",value:function _parseTipos(e){this.tiposDisponibles=e.map(function(e){return{label:""+e.Nombre,value:e.IdTipoUT}})}},{key:"_parseProyectos",value:function _parseProyectos(e){this.proyectosDisponibles=e.map(function(e){return{label:""+e.Nombre,value:e.IdProyecto}}),this.proyectosDisponibles.push({label:"<Sin Proyecto>",value:null})}},{key:"_parseProductos",value:function _parseProductos(e){this.productosDisponibles=e.map(function(e){return{label:""+e.Nombre,value:e.IdProducto}})}},{key:"_mapSelected",value:function _mapSelected(e,t){this.sprintsDisponibles.forEach(function(o){o.value==e.UT.IdVersion&&(t.IdVersion=o.value)}),this.workflowsDisponibles.forEach(function(o){o.value==e.UT.IdWorkflow&&(t.IdWorkflow=o.value)}),this.tiposDisponibles.forEach(function(o){o.value==e.UT.IdTipoUT&&(t.IdTipoUT=o.value)}),this.proyectosDisponibles.forEach(function(o){o.value==e.UT.IdProyecto&&(t.IdProyecto=o.value)}),this.productosDisponibles.forEach(function(o){o.value==e.UT.IdProducto&&(t.IdProducto=o.value)})}},{key:"ngOnDestroy",value:function ngOnDestroy(){this._breadcrumbService.removeItems(1),this._saveDetailsSubscription&&!this._saveDetailsSubscription.closed&&this._saveDetailsSubscription.unsubscribe(),this._getUtSub&&!this._getUtSub.closed&&this._getUtSub.unsubscribe()}}]),DetailsComponent}())||_;Reflect.defineMetadata("design:paramtypes",[o.ActivatedRoute,f,n.NotificationsService,i.BreadcrumbService],b);var m,g,y=(m=t.Injectable())(g=function(){function CreateUTService(e){l(this,CreateUTService),this._http=e,this._url="UTs/Crear"}return a(CreateUTService,[{key:"put",value:function put(e){return this._http.put(this._url,e)}}]),CreateUTService}())||g;Reflect.defineMetadata("design:paramtypes",[r.HttpClient],y);var T,U,S=(T=t.Injectable())(U=function(){function GetProductosService(e){l(this,GetProductosService),this._http=e,this._url="Productos2"}return a(GetProductosService,[{key:"get",value:function get$$1(){return this._http.get(""+this._url)}}]),GetProductosService}())||U;Reflect.defineMetadata("design:paramtypes",[r.HttpClient],S);var w,k,P=(w=t.Injectable())(k=function(){function GetProyectosService(e){l(this,GetProyectosService),this._http=e,this._url="Productos"}return a(GetProyectosService,[{key:"get",value:function get$$1(e){return this._http.get(this._url+"/"+e+"/Proyectos")}}]),GetProyectosService}())||k;Reflect.defineMetadata("design:paramtypes",[r.HttpClient],P);var I,C,M=(I=t.Injectable())(C=function(){function GetSprintsProductoService(e){l(this,GetSprintsProductoService),this._http=e,this._url="Sprints2"}return a(GetSprintsProductoService,[{key:"get",value:function get$$1(e){return this._http.get(this._url+"/"+e)}}]),GetSprintsProductoService}())||C;Reflect.defineMetadata("design:paramtypes",[r.HttpClient],M);var D,N,x=(D=t.Injectable())(N=function(){function GetTiposUTProductoService(e){l(this,GetTiposUTProductoService),this._http=e,this._url="TiposUT2"}return a(GetTiposUTProductoService,[{key:"get",value:function get$$1(e){return this._http.get(this._url+"/"+e)}}]),GetTiposUTProductoService}())||N;Reflect.defineMetadata("design:paramtypes",[r.HttpClient],x);var W,G,O=(W=t.Injectable())(G=function(){function GetWorkflowsService(e){l(this,GetWorkflowsService),this._http=e,this._url="Workflows"}return a(GetWorkflowsService,[{key:"get",value:function get$$1(e){return this._http.get(this._url+"/"+e)}}]),GetWorkflowsService}())||G;Reflect.defineMetadata("design:paramtypes",[r.HttpClient],O);__$styleInject(".tn-ut__form{padding:16px}.tn-ut__form__section{padding:8px}.tn-ut__form__dropdown{width:100%}",void 0);var E,V,j=[],R=[],$=[],z=[],A=(E=t.Component({selector:"tn-ut-nuevaut",template:'<form class="tn-ut__form vertical">\r\n  <div class="horizontal">\r\n    <div class="vertical seven tn-ut__form__section">\r\n      <label>Nombre</label>\r\n      <input type="text" size="30" [(ngModel)]="ut.Nombre" name="nombre" pInputText>\r\n    </div>\r\n    <div class="vertical five tn-ut__form__section">\r\n      <label>Sprint</label>\r\n      <p-dropdown [options]="sprints" optionLabel="name" [(ngModel)]="ut.IdVersion" [style]="{\'width\':\'100%\'}" filter="true" name="sprint"></p-dropdown>\r\n    </div>\r\n  </div>\r\n  <div class="horizontal">\r\n    <div class="vertical five tn-ut__form__section">\r\n      <label>Producto</label>\r\n      <p-dropdown [options]="productos" optionLabel="name" [(ngModel)]="ut.IdProducto" [style]="{\'width\':\'100%\'}" filter="true" name="producto" (onChange)="onProductChanged($event.value)"></p-dropdown>\r\n    </div>\r\n    <div class="vertical three tn-ut__form__section">\r\n      <label>Tipo</label>\r\n      <p-dropdown [options]="tiposUT" optionLabel="name" [(ngModel)]="ut.IdTipoUT" [style]="{\'width\':\'100%\'}" name="tipo" filter="true"></p-dropdown>\r\n    </div>\r\n  </div>\r\n  <div class="horizontal">\r\n    <div class="vertical seven tn-ut__form__section">\r\n      <label>Proyecto</label>\r\n      <p-dropdown [options]="proyectos" optionLabel="name" [(ngModel)]="ut.IdProyecto" [style]="{\'width\':\'100%\'}" name="idproyecto" filter="true"></p-dropdown>\r\n    </div>\r\n    <div class="vertical five tn-ut__form__section">\r\n      <label>Workflow</label>\r\n      <p-dropdown [options]="workflows" optionLabel="name" [(ngModel)]="ut.IdWorkflow" [style]="{\'width\':\'100%\'}" name="idworkflow" filter="true"></p-dropdown>\r\n    </div>\r\n  </div>\r\n  <div class="horizontal tn-ut__form__section">\r\n    <button pButton type="button" label="Crear & Nueva" [disabled]="isNombreEmpty()" (click)="onCrearNuevaUTClick()"></button>\r\n    <button pButton type="button" label="Crear & Abrir" [disabled]="isNombreEmpty()" (click)="onCrearYAbrirUTClick()"></button>\r\n  </div>\r\n</form>\r\n',providers:[y,S,P,M,x,O]}))(V=function(){function NuevaUTComponent(e,t,o,i,r,n,s){l(this,NuevaUTComponent),this.ut={Nombre:null,IdVersion:null,IdProducto:null,IdWorkflow:null,IdTipoUT:null,IdProyecto:null},this._createUTService=e,this._getProductosService=t,this._getProyectosService=o,this._getSprintsService=i,this._getWorkflowsService=n,this._getTiposUTService=r,this._notificationService=s,this.productos=[],this.proyectos=[],this.sprints=[],this.tiposUT=[],this.workflows=[]}return a(NuevaUTComponent,[{key:"ngOnInit",value:function ngOnInit(){this._getProductos()}},{key:"_getProductos",value:function _getProductos(){var e=this;this._getProductosSubscription=this._getProductosService.get().subscribe(function(t){e.productos=e._parseProductos(t),e.productos.length>0&&(e.ut.IdProducto=e.productos[0].value,e._getDatosProducto(e.productos[0].value))},function(t){return e._notificationService.error("No se han podido obtener los productos",t)})}},{key:"_parseProductos",value:function _parseProductos(e){return e.map(function(e){return{label:""+e.Nombre,value:e.IdProducto}})}},{key:"_getDatosProducto",value:function _getDatosProducto(e){this.workflows=this._getWorkflows(e),this.proyectos=this._getProyectos(e),this.sprints=this._getSprints(e),this.tiposUT=this._getTiposUT(e)}},{key:"_getWorkflows",value:function _getWorkflows(e){var t=this;return z[e]||(this._getWorkflowsSubscription=this._getWorkflowsService.get(e).subscribe(function(o){z[e]=t._parseWorkflows(o),t.workflows=z[e],t.ut.IdVersion=t.workflows[0]?t.workflows[0].value:null})),z[e]}},{key:"_parseWorkflows",value:function _parseWorkflows(e){return e.map(function(e){return{label:""+e.Nombre,value:e.IdWorkflow}})}},{key:"_getProyectos",value:function _getProyectos(e){var t=this;return j[e]||(this._getProyectoSubscription=this._getProyectosService.get(e).subscribe(function(o){j[e]=t._parseProyectos(o),t.proyectos=j[e],t.ut.IdProyecto=t.proyectos[0]?t.proyectos[0].value:null},function(e){return t._notificationService.error("No se han podido obtener los proyectos del producto",e)})),j[e]}},{key:"_parseProyectos",value:function _parseProyectos(e){return e.map(function(e){return{label:""+e.Nombre,value:e.IdProyecto}})}},{key:"_getTiposUT",value:function _getTiposUT(e){var t=this;return $[e]||(this._getTiposUTSubscription=this._getTiposUTService.get(e).subscribe(function(o){$[e]=t._parseTiposUT(o),t.tiposUT=$[e],t.ut.IdTipoUT=t.tiposUT[0]?t.tiposUT[0].value:null},function(e){return t._notificationService.error("No se han podido obtener los tipos de UT",e)})),$[e]}},{key:"_parseTiposUT",value:function _parseTiposUT(e){return e.map(function(e){return{label:""+e.Nombre,value:e.IdTipoUT}})}},{key:"_getSprints",value:function _getSprints(e){var t=this;return R[e]||(this._getSprintsSubscription=this._getSprintsService.get(e).subscribe(function(o){R[e]=t._parseSprints(o),t.sprints=R[e],t.ut.IdVersion=t.sprints[0]?t.sprints[0].value:null},function(e){t._notificationService.error("No se han podido obtener los Sprints del producto",e)})),R[e]}},{key:"_parseSprints",value:function _parseSprints(e){return e.map(function(e){return{label:""+e.Nombre,value:e.IdVersion}})}},{key:"onProductChanged",value:function onProductChanged(e){this._getDatosProducto(e)}},{key:"onCrearNuevaUTClick",value:function onCrearNuevaUTClick(){var e=this;this._crearUTSubscription=this._createUTService.put(this.ut).subscribe(function(e){},function(t){e._notificationService.error("No se pudo crear la UT especficada",t)})}},{key:"onCrearYAbrirUTClick",value:function onCrearYAbrirUTClick(){var e=this;this._crearUTSubscription=this._createUTService.put(this.ut).subscribe(function(t){e.idUt=t},function(t){e._notificationService.error("No se pudo crear la UT especficada",t)})}},{key:"isNombreEmpty",value:function isNombreEmpty(){return null==this.ut.Nombre||0===this.ut.Nombre.length}},{key:"ngOnDestroy",value:function ngOnDestroy(){this._crearUTSubscription&&!this._crearUTSubscription.closed&&this._crearUTSubscription.unsubscribe(),this._getProductosSubscription&&!this._getProductosSubscription.closed&&this._getProductosSubscription.unsubscribe(),this._getProyectoSubscription&&!this._getProyectoSubscription.closed&&this._getProyectoSubscription.unsubscribe(),this._getSprintsSubscription&&!this._getSprintsSubscription.closed&&this._getSprintsSubscription.unsubscribe(),this._getTiposUTSubscription&&!this._getTiposUTSubscription.closed&&this._getTiposUTSubscription.unsubscribe(),this._getWorkflowsSubscription&&!this._getWorkflowsSubscription.closed&&this._getWorkflowsSubscription.unsubscribe()}}]),NuevaUTComponent}())||V;Reflect.defineMetadata("design:paramtypes",[y,S,P,M,x,O,n.NotificationsService],A);var B,H,L,q,Y=(B=t.NgModule({imports:[o.RouterModule.forChild([{path:"",component:c},{path:"add",component:A},{path:":id",component:b}])],exports:[o.RouterModule]}))(H=function UtRoutingModule(){l(this,UtRoutingModule)})||H,F=(L=t.NgModule({imports:[n.TuneUpCoreModule,Y],declarations:[c,b,A],providers:[f]}))(q=function UtModule(){l(this,UtModule)})||q;e.UtModule=F,e.DetailsComponent=b,e.DetailsService=f,e.NuevaUTComponent=A,e.CreateUTService=y,e.GetProductosService=S,e.GetProyectosService=P,e.GetSprintsProductoService=M,e.GetTiposUTProductoService=x,e.GetWorkflowsService=O,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=tune-up.ut.umd.js.map
